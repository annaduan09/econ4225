---
title: "ECON4225 Homework 1"
output: 
  pdf_document:
    number_sections: no
    keep_md: yes
date: "2025-10-06"
author: "Anna Duan"
---
```{r setup, echo=FALSE, message=FALSE, include=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(pander)
library(scales)

psid <- read_csv("data/PSID_CLEAN.csv")
```

# Part 1: Overview of the Dataset 
## Question 1: household and variable count
This dataset has 9066 households and 38 variables, including the household ID.
```{r households, echo=FALSE}
print(paste("rows:" , nrow(psid)))
names(psid)
```

## Question 2  
The average age of the household head is 46.25. The highest age is 102 and the lowest age is 18.
```{r age, echo=FALSE}
print(paste("Mean age:" , round(mean(psid$AGE_HEAD),2)))
print(paste("Highest age:" , round(max(psid$AGE_HEAD),2)))
print(paste("Lowest age:" , round(min(psid$AGE_HEAD),2)))
```

## Question 3: Income
The average household income is $78,265.69. This is substantially lower the $142k reported by the SCF in 2022 (Section 1.2, slide 9). One possible reason for this difference is that the SCF surveys a small sample, focusing on high-income individuals, resulting in a less representative mean. The PSID has a larger sample, with less emphasis on the top of the income distribution.
```{r income, echo=FALSE}
print(paste("Mean household income:" , round(mean(psid$INCOME),2)))
```

## Question 4: income range  
The household incomes in the dataset have a wide range: the lowest is -$267,900 and the highest is $2,125,100. The households with negative income are likely in debt.
```{r income min max, echo=FALSE}
print(paste("Lowest household income:" , round(min(psid$INCOME),2)))
print(paste("Highest household income:" , round(max(psid$INCOME),2)))
```

## Question 5: spouse age  
Of the 4,523 households with a spouse of the household head present, the average age of the spouse is 45.64 years.
```{r age of spouse, echo=FALSE}
psid_spouse <- psid %>%
  filter(SPOUSE_PRESENT==1 & AGE_SPOUSE>0)

print(paste("Mean spouse age:" , round(mean(psid_spouse$AGE_SPOUSE),2)))
```

## Question 6: household members
Households with only 1 member make up 28.45% of the data. Households with 5 or more members make up 11.29%. Compared to the histogram shown in class, the PSID has fewer 2-member households and more 3-5 member households. In both datasets, about 28% of households have one member. The PSID dataset has a smaller share of two-member households: only 30.43% compared to the nearly 35% shown on slide 2 [what dataset is this?]. PSID has a slightly larger share of households with 3 members: 15.95%, compared to the slide's 15%; a 13.88% share of 4-member households, compared to the slide's 12.5%; and a 7.2% share of 5-member households, compared to just past 5% in the slide. 
```{r hh size summary, echo=FALSE}
psid_hh_size <- psid %>%
  mutate(size_group = case_when(
    HOUSEHOLD_SIZE == 1 ~ "1",
    HOUSEHOLD_SIZE >= 2 & HOUSEHOLD_SIZE <= 4 ~ "2â€“4",
    HOUSEHOLD_SIZE >= 5 ~ "5+"
  ))  %>%
  group_by(size_group, HOUSEHOLD_SIZE) %>%
  summarise(count = n(), .groups = "drop") %>%
  mutate(pct = 100 * count / sum(count))

psid_hh_size %>%
  group_by(size_group) %>%
  summarize(count = sum(count),
            pct = sum(pct)) %>%
  pander(caption = "Percentage share of PSID households by size")
```

```{r hh size hist, echo=FALSE}
ggplot(psid_hh_size, aes(x = HOUSEHOLD_SIZE, y = pct, fill = size_group)) +
  geom_col() +
  theme_minimal() +
  scale_y_continuous(labels = label_percent(scale = 1)) +
  scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)) +
  labs(
    title = "Most households have fewer than 5 members",
    subtitle = "Distribution of households by number of members, PSID",
    x = "Household Size",
    y = "Percentage share",
    fill = ""
  ) +
  theme(legend.position = "bottom")

```

# Part 2: Income Distribution   
## Question 1
The following histogram shows the distribution of household incomes in the PSID, with values above the 99th percentile removed. The distribution is right-skewed, as the median of $55,090 is lower than the mean of $78,266. The majority of households earn less than $100,682, which is the 75th percentile. A small minority of households surveyed have higher household incomes, up to $2.13 million. 137 households have no income, and three households have negative income, with the lowest income being $267,900.

```{r hh income hist, echo=FALSE}
summary(psid$INCOME) %>%
  pander(caption = "Distribution of Household Incomes") 

ggplot(psid, aes(x = INCOME/1000)) +
  geom_histogram(binwidth = 5, fill = "steelblue") +
  theme_minimal() +
  labs(
    title = "Most house",
    subtitle = "Distribution of households by household income, PSID",
    x = "Household Income, thousands ($)",
    y = "Households",
    fill = ""
  ) +
  theme(legend.position = "bottom")
```

## Question 2 
The following Lorenz curve visualizes the cumulative share of households (x) against the cumulative share of total household income (y). The dotted line is what the curve would look like at perfect inequality, where 50% of households possess 50% of total household income. The solid red line represents the relationship between cumulative household share and cumulative household income share. 

We see on this curve that the lowest earning 50% of households in the PSID account for only 18% of total household income, and that the bottom 75% of households account for 42% of income. By contrast, the top 10% of highest earning households account for about a third of all household income, and the top 1% of households account for just above 8%. In this dataset, we can tell that higher-earning households account for more than their proportional share of household income.
```{r hh income lorenz, echo=FALSE}
perfect_equality <- data.frame(x = c(0, 25, 75, 100), y = c(0, 25, 75, 100))

psid_lorenz <- psid %>%
  arrange(INCOME) %>%
  mutate(INC_SHARE = INCOME / sum(INCOME),
    HHS_SHARE = 1 / nrow(.),
    CUM_HH_SHARE = 100*cumsum(HHS_SHARE),
    CUM_INC_SHARE = 100*cumsum(INC_SHARE))

ggplot() +
  geom_line(data = psid_lorenz, aes(x = CUM_HH_SHARE, y = CUM_INC_SHARE, color = "PSID households")) +
  geom_line(data = perfect_equality, aes(x = x, y = y, color = "perfect equality"), linetype = "dotted") +
  theme_minimal() +
  scale_color_manual(values = c("gray30", "tomato"), name = "") + 
  labs(
    title = "Lorenz Curve of Household Income",
    subtitle = "Households and income, PSID",
    x = "Cumulative share of households",
    y = "Cumulative share of total income"
  ) +
  theme(legend.position = "bottom")
```
# ? SCF
## Question 3 
To further quantify the level of income inequality in the dataset, we can calculate the coefficient of variation by dividing the standard deviation in household income by the mean household income. This produces a coefficient of variation of 1.15, which is ______ compared to the ______ derived from the SCF. 
```{r coefficient of variation hh income, echo=FALSE}
print(paste("Coefficient of variation of household income:", round(sd(psid$INCOME)/mean(psid$INCOME),2)))
```

#? adjustment method
## Question 4 
When we adjust this curve for the number of household heads present, the distance from the line of perfect equality decreases. On the yellow curve representing the relationship between adjusted income share and population share, we see that the bottom 50% of households account for 21% of income, compared to the 18% on the non-adjusted curve. 

This indicates that some of the inequality among households may be attributed to differences in household size and the number of earners. 

```{r lorenz curve comparison, echo=FALSE}
psid_lorenz_adj <- psid %>%
  mutate(spouse_adjust = ifelse(SPOUSE_PRESENT == 1, 2, 1),
    income_per_head = INCOME/spouse_adjust) %>%
    arrange(income_per_head) %>%
  mutate(
    INC_SHARE = income_per_head / sum(income_per_head),
    HHS_SHARE = 1 / nrow(.),
    CUM_HH_SHARE = 100*cumsum(HHS_SHARE),
    CUM_INC_SHARE = 100*cumsum(INC_SHARE))

ggplot() +
  geom_line(data = psid_lorenz, aes(x = CUM_HH_SHARE, y = CUM_INC_SHARE, color = "PSID Households")) +
  geom_line(data = perfect_equality, aes(x = x, y = y, color = "perfect equality"), linetype = "dotted") +
  geom_line(data = psid_lorenz_adj, aes(x = CUM_HH_SHARE, y = CUM_INC_SHARE, color = "PSID Households: Adjusted")) +
  theme_minimal() +
  scale_color_manual(values = c("gray30", "tomato", "goldenrod1"), name = "") + 
  labs(
    title = "Lorenz Curve of Household Income",
    subtitle = "Households and income, PSID",
    x = "Cumulative share of households",
    y = "Cumulative share of total income"
  ) +
  theme(legend.position = "bottom")

```

## Question 5 
The table below displays the 30th, 50th, 90th, and 99th percentiles of household income in the dataset. The wide gap between the 50th and 90th and 50th and 99th percentiles give us a sense of the income inequality among the households, but percentiles themselves are insufficient. 
```{r hh income percentiles, echo=FALSE}
data.frame(percentile = c("30th", "50th", "90th", "99th"), 
           value = c(paste("$",round(quantile(psid$INCOME, 0.3), 2), sep=""), 
                     paste("$",round(quantile(psid$INCOME, 0.5), 2), sep=""),
                     paste("$",round(quantile(psid$INCOME, 0.9), 2), sep=""),
                     paste("$",round(quantile(psid$INCOME, 0.99), 2), sep=""))) %>%
  as_tibble() %>%
  pander(caption = "PSID Household Income Percentiles")
```
The percentile ratios in the table reveal a markedly unequal income distribution. Households at the top earn several times more than those in the middle or bottom. Specifically, households at the 90th percentile earn nearly three times the median income, while those at the 99th percentile earn 7.2 times the median, indicating extreme concentration of income at the very top. The 2.67 ratio between the 30th and 10th percentiles shows that inequality at the lower end exists but is considerably smaller than that among top earners.
```{r percentile ratios, echo=FALSE}
data.frame(percentile_ratio = c("90-30", "90-50", "30-10", "99-50"), 
           value = c(round(quantile(psid$INCOME, 0.9)/quantile(psid$INCOME, 0.3), 2), 
                     round(quantile(psid$INCOME, 0.9)/quantile(psid$INCOME, 0.5), 2),
                     round(quantile(psid$INCOME, 0.3)/quantile(psid$INCOME, 0.1), 2),
                     round(quantile(psid$INCOME, 0.99)/quantile(psid$INCOME, 0.5), 2))) %>%
  as_tibble() %>%
  pander(caption = "PSID Household Income Percentile Ratios")
```

# ? SCF
- Comparison with SCF 


## Question 6 
The following table further illustrates this pattern of income inequality among PSID households: the greatest disparities between consecutive quintiles are between quintiles 2 and 1 and quintiles 5 and 4. Quintile 2 has a mean income of $33,188, 2.76 times the first quintile's mean income of $12,003. The second quintile's income share of 8.5% is 2.74 times that of the first quintile (3.1%). The fifth quintile's income of $199,894 is 2.21 times that of the fourth quintile ($90,408). The fifth quintile's income share of 51.1% is 2.39 times that of the fourth quintile. It's also notable that the income share of the top quintile is greater than that of the remaining 4 quintiles. Taken together, this shows the high overall income inequality among PSID households, as well as the heightened inequality at the bottom and top of the distributions. 

```{r income quintiles table, echo=FALSE}
psid_quintile <- psid %>%
  select(INCOME) %>%
  mutate(quintile = case_when(INCOME <= quantile(psid$INCOME, 0.2) ~ "1",
                              INCOME <= quantile(psid$INCOME, 0.4) ~ "2",
                              INCOME <= quantile(psid$INCOME, 0.6) ~ "3",
                              INCOME <= quantile(psid$INCOME, 0.8) ~ "4",
                              TRUE ~ "5")) %>%
  group_by(quintile) %>%
  summarize(income_quintile = sum(INCOME),
            mean_income = mean(INCOME)) %>%
  mutate(income_share = income_quintile/sum(income_quintile)) %>%
  select(quintile, income_share, mean_income)

psid_quintile %>%
  mutate(income_share = percent(income_share),
         mean_income=dollar(mean_income)) %>%
  pander(caption="Share of total household income and mean income by quintile")
```

```{r income quintile viz}
psid_quintile %>%
  ggplot(aes(x = quintile, y = income_share)) +
  geom_col(fill = "darkslategray") +
  geom_text(aes(label = percent(income_share)),
            vjust = -0.3, size = 3.5) +
  scale_y_continuous(labels = percent) +
  labs(title="Top 20% of PSID households earns more income than bottom 80%", subtitle= "Share of total household income by quintile", x = "Income Quintile", y = "Share of Total Income") +
  theme_minimal()

```
# ? SCF
dollar(mean_income)

## Question 7 
As discussed in class, quintiles can obfuscate the inequality within the top of the distribution. Looking at the top 1% of high earning households, we see that their mean income ($639,974) is 8.81 times that of the bottom 99% ($72,570), and 3.2 times that of the top 20%. In terms of income share, the top 1% accounts for 8% of all household income, making up nearly one-sixth of the top quintile's share. Even within the top quintile, there is drastic inequality between the highest and lowest earners. 
```{r income top 1%, echo=FALSE}
psid_1pct <- psid %>%
  select(INCOME) %>%
  mutate(group = case_when(INCOME > quantile(psid$INCOME, 0.99) ~ "top 1%",
                              TRUE ~ "bottom 99%")) %>%
  group_by(group) %>%
  summarize(income_group = sum(INCOME),
            mean_income = mean(INCOME)) %>%
  mutate(income_share = income_group/sum(income_group)) %>%
  select(group, income_share, mean_income)

psid_1pct %>%
  mutate(income_share = percent(income_share),
         mean_income=dollar(mean_income)) %>%
  pander(caption="Share of total household income and mean income held by the top 1%")
```
? SCF
compare with scf distribution 

# Part 3: Labor Income   
## Question 1 
- Create variable of total labor income of household
- Earnings and share of earnings for each quintile 

## Question 2 
- Compare distribution of household earnings vs income 
- Compare share of quintiles
- Coefficient of variation 
- Lorenz curve of labor earnings and total household income 
- Compare relative inequality in labor earnings vs total household income 

## Question 3 
- Create variable of share of labor earnings in total household income 
- Average share of labor earnings 

## Question 4 
- Average share of labor earnings by quintile of income distribution 
- Share of labor earnings for top 1% 
- Compare both to SCF
- Comment on differences 

## Question 5 
- Filter by households where household head has positive work weeks and positive earnings 
- Weekly wage of household head 
- Variance of log of earnings, wages, weeks worked
- Relative contribution of hours and wages to inequality in labor earnings? 
- Caveats to this calculation? 

## Question 6 
- Regression of log wages of household head on age, age^2, education, occupation
- Residuals 
- Variance of residuals 
- Share of inequality explained by age, education and occupation?
 