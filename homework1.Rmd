---
title: "ECON4225 Homework 1"
output: 
  pdf_document:
    number_sections: no
    keep_md: yes
date: "2025-10-06"
author: "Anna Duan"
---
```{r setup, echo=FALSE, message=FALSE, include=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(pander)
library(scales)
library(stargazer)

psid <- read_csv("data/PSID_CLEAN.csv")
```

# Part 1: Overview of the Dataset 
## Question 1: household and variable count
This dataset has 9066 households and 38 variables, including the household ID.
```{r households, echo=FALSE}
print(paste("PSID row count:" , nrow(psid)))
print(paste("PSID variable count:", length(names(psid))))
```

## Question 2: age of household head  
The average age of the household head is 46.25. The highest age is 102 and the lowest age is 18.
```{r age, echo=FALSE}
print(paste("Mean age:" , round(mean(psid$AGE_HEAD),2)))
print(paste("Highest age:" , round(max(psid$AGE_HEAD),2)))
print(paste("Lowest age:" , round(min(psid$AGE_HEAD),2)))
```

## Question 3: average household income  
The average household income is $78,265.69. This is lower than the $142,000 reported by the SCF (based on class slides for Section 1.2, slide 9). One possible reason for this difference is that the SCF intentionally oversamples wealthy households to collect information about the income and wealth patterns at the top of the income distribution. In addition to SCF's intentional focus on a high-income subset of the population, other differences that may create differences in the mean household income collected include SCF's smaller sample size (6k, compared to PSID's 10k) and lower frequency. 

SCF also surveys a smaller (6k) group compared to PSID (10k). 
```{r income, echo=FALSE}
print(paste("Mean household income:" , round(mean(psid$INCOME),2)))
```

## Question 4: income range   
The household incomes in the dataset have a wide range: the lowest is -$267,900 and the highest is $2,125,100. According to the codebook, the households with negative incomes likely incurred business or farm losses. This may include losses from business investments, farming, or other financial decisions. 
```{r income min max, echo=FALSE}
print(paste("Lowest household income:" , round(min(psid$INCOME),2)))
print(paste("Highest household income:" , round(max(psid$INCOME),2)))
```

## Question 5: age of household head's spouse     
Of the 4,523 households with a spouse present, the average age of the spouse is 45.64 years.
```{r age of spouse, echo=FALSE}
psid_spouse <- psid %>%
  filter(SPOUSE_PRESENT==1)

print(paste("Mean spouse age:" , round(mean(psid_spouse$AGE_SPOUSE),2)))
```

## Question 6: household size    
The average household in the dataset has 2.6 members. Households with only 1 member make up 28.45% of the data. Households with 5 or more members make up 11.29%.   

```{r hh size summary, echo=FALSE}
psid_hh_size <- psid %>%
  mutate(size_group = case_when(
    HOUSEHOLD_SIZE == 1 ~ "1",
    HOUSEHOLD_SIZE >= 2 & HOUSEHOLD_SIZE <= 4 ~ "2â€“4",
    HOUSEHOLD_SIZE >= 5 ~ "5+"
  ))  %>%
  group_by(size_group, HOUSEHOLD_SIZE) %>%
  summarise(count = n(), .groups = "drop") %>%
  mutate(pct = 100 * count / sum(count))

psid_hh_size %>%
  group_by(size_group) %>%
  summarize(count = sum(count),
            pct = sum(pct)) %>%
  pander(caption = "Percentage share of PSID households by size")  

```   

  
The histogram below shows the distribution of households by member count in the PSID dataset. Compared to the SCF histogram shown in class, the PSID histogram has fewer 2-member households and more 3-5 member households. The PSID dataset has 30.43% two-member households compared to the nearly 35% shown on Slide 2 of Section 1.1. PSID has a slightly larger share of households with 3 members: 15.95%, compared to the slide's 15%; a 13.88% share of 4-member households, compared to the slide's 12.5%; and a 7.2% share of 5-member households, compared to just past 5% in the slide.   

```{r hh size hist, echo=FALSE}
ggplot(psid_hh_size, aes(x = HOUSEHOLD_SIZE, y = pct, fill = size_group)) +
  geom_col() +
  theme_minimal() +
  scale_y_continuous(labels = label_percent(scale = 1)) +
  scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)) +
  scale_fill_manual(values = c("darkslategray2", "darkslategray4", "darkslategray")) +
  labs(
    title = "Distribution of households by number of members, PSID",
    x = "Household Size",
    y = "Percentage share of PSID households",
    fill = "Members"
  ) +
  theme(legend.position = "bottom")

```

# Part 2: Income Distribution    
## Question 1: distribution of household income  
The following histogram shows the distribution of household incomes in the PSID, with outliers exceeding the 99th percentile ($396,420). The distribution is right-skewed, as the median of $55,090 is lower than the mean of $78,266. The majority of households earn less than $100,682, which is the 75th percentile. 25% of households surveyed have higher household incomes, up to $2.125 million. 137 households have no income, and three households have negative income, with the lowest income being -$267,900.

```{r hh income hist, echo=FALSE}
summary(psid$INCOME) %>%
  pander(caption = "Distribution of Household Incomes") 

ggplot(psid %>% filter(INCOME < quantile(INCOME, 0.99)), aes(x = INCOME/1000)) +
  geom_histogram(binwidth = 5, fill = "darkslategray", color = "white") +
  theme_minimal() +
  labs(
    title = "Distribution of household incomes, PSID (binwidth = $5,000)",
    subtitle = "Binwidth - $5000, outliers exceeding 99th percentile removed", 
    x = "Household Income, thousands ($)",
    y = "Households",
    fill = ""
  ) +
  theme(legend.position = "bottom")
```

## Question 2: household income Lorenz curve   
The following Lorenz curve visualizes the cumulative share of households (x) against the cumulative share of income (y). The dotted line is what the curve would look like at perfect equality, where the bottom 50% of households possess 50% of total household income. The solid red line represents the relationship between cumulative household share and cumulative income share in reality.
  
```{r hh income lorenz, echo=FALSE}
perfect_equality <- data.frame(x = c(0, 25, 75, 100), y = c(0, 25, 75, 100))

psid_lorenz <- psid %>%
  arrange(INCOME) %>%
  mutate(INC_SHARE = INCOME / sum(INCOME),
    HHS_SHARE = 1 / nrow(.),
    CUM_HH_SHARE = 100*cumsum(HHS_SHARE),
    CUM_INC_SHARE = 100*cumsum(INC_SHARE))

ggplot() +
  geom_line(data = psid_lorenz, aes(x = CUM_HH_SHARE, y = CUM_INC_SHARE, color = "PSID households")) +
  geom_line(data = perfect_equality, aes(x = x, y = y, color = "perfect equality"), linetype = "dotted") +
  theme_minimal() +
  scale_color_manual(values = c("gray30", "tomato"), name = "") + 
  labs(
    title = "Lorenz Curve of Household Income",
    subtitle = "Households and income, PSID",
    x = "Cumulative share of households",
    y = "Cumulative share of total income"
  ) +
  theme(legend.position = "bottom")
```  


We see on this curve that the lowest earning 50% of households in the PSID account for only 18% of total household income, and that the bottom 75% of households account for 42% of income. By contrast, the top 10% of highest earning households account for about a third of all household income, and the top 1% of households make around 8%. In this dataset, we can tell that high-earning households account for more than their proportional share of household income, indicating income inequality within the sample.      


## Question 3: total household income coefficient of variation   
To further quantify the level of income inequality in the dataset, we can calculate the coefficient of variation by dividing the standard deviation in household income by the mean household income. This produces a coefficient of variation of 1.15, which is lower compared to the SCF. Based on slide 14 of Section 1.2 in the lecture slides, the coefficient of variation derived from the SCF was 4.61 in 1989, 4.83 in 2019, and 5.31 in 2022. This tells us that there is less income inequality in the PSID sample than in the SCF samples. 
```{r coefficient of variation hh income, echo=FALSE}
print(paste("Coefficient of variation of household income:", round(sd(psid$INCOME)/mean(psid$INCOME),3)))
```


## Question 4: adjusted total household income Lorenz curve    
When we adjust household income based on the number of household heads present, our Lorenz curve moves closer to the line of perfect equality, meaning that adjusting household income by the number of household heads decreases income inequality. This is intuitive: we are now adjusting for the number of potential earners in a household, allowing for a more fair comparison between households with one and two heads.  

On the yellow curve representing the relationship between adjusted income share and household share, we see that the bottom 50% of households account for 21% of income, compared to the 18% on the non-adjusted curve. This indicates that some of the inequality among households may be attributed to differences in household size and the number of earners. 

```{r lorenz curve comparison, echo=FALSE}
psid_lorenz_adj <- psid %>%
  mutate(spouse_adjust = ifelse(SPOUSE_PRESENT == 1, 2, 1),
    income_per_head = INCOME/spouse_adjust) %>%
    arrange(income_per_head) %>%
  mutate(
    INC_SHARE = income_per_head / sum(income_per_head),
    HHS_SHARE = 1 / nrow(.),
    CUM_HH_SHARE = 100*cumsum(HHS_SHARE),
    CUM_INC_SHARE = 100*cumsum(INC_SHARE))

ggplot() +
  geom_line(data = psid_lorenz, aes(x = CUM_HH_SHARE, y = CUM_INC_SHARE, color = "PSID Households")) +
  geom_line(data = perfect_equality, aes(x = x, y = y, color = "perfect equality"), linetype = "dotted") +
  geom_line(data = psid_lorenz_adj, aes(x = CUM_HH_SHARE, y = CUM_INC_SHARE, color = "PSID Households: Adjusted")) +
  theme_minimal() +
  scale_color_manual(values = c("gray30", "tomato", "goldenrod1"), name = "") + 
  labs(
    title = "Lorenz Curve of Household Income, adjusted by number of household heads",
    subtitle = "Households and income, PSID",
    x = "Cumulative share of households",
    y = "Cumulative share of total income"
  ) +
  theme(legend.position = "bottom")

```

## Question 5: household income percentile ratios   
The table below displays the 30th, 50th, 90th, and 99th percentiles of household income in the dataset. Based on these percentile, we know that 30% of the sampled households earn $33,107.50 or less per year; 50% earn $55,090 or less; 90% earn $161,188 or less; and 99% earn $396,420 or less. The wide gap between the 50th and the 90th percentile is a clear marker of income inequality. 
```{r hh income percentiles, echo=FALSE}
data.frame(percentile = c("30th", "50th", "90th", "99th"), 
           value = c(dollar(quantile(psid$INCOME, 0.3)), 
                     dollar(quantile(psid$INCOME, 0.5)),
                     dollar(quantile(psid$INCOME, 0.9)),
                     dollar(quantile(psid$INCOME, 0.99)))) %>%
  as_tibble() %>%
  pander(caption = "PSID Household Income Percentiles")
```
  
The percentile ratios in the table further illustrate a highly unequal income distribution, where households at the top earn several times more than those in the middle or bottom. The 90-30 ratio is 4.87, meaning households at the top earn 4.87 times what households at the bottom earn. The 90-50 ratio is 2.93, meaning households at the top earn 2.93 times what households in the middle earn. The 30-10 ratio is 2.67, meaning there is income inequality within the bottom as well, with those at the 30th percentile earning 2.67 times what those at the 10th percentile earn. The 99-50 ratio is 7.2, meaning that households at the very top of the distribution earn 7.2 times what households in the middle earn, indicating extreme concentration of income at the very top. 

The numbers in the SCF are even more drastic: in 2022, the 90-50 ratio was 3.54 and the 99-50 ratio was 17.05. This may be due to SCF's sampling again: by over-sampling the ultra-wealthy, the SCF likely captures much higher incomes in the upper end of its distribution than the PSID does. 

```{r percentile ratios, echo=FALSE}
data.frame(percentile_ratio = c("90-30", "90-50", "30-10", "99-50"), 
           value = c(round(quantile(psid$INCOME, 0.9)/quantile(psid$INCOME, 0.3), 2), 
                     round(quantile(psid$INCOME, 0.9)/quantile(psid$INCOME, 0.5), 2),
                     round(quantile(psid$INCOME, 0.3)/quantile(psid$INCOME, 0.1), 2),
                     round(quantile(psid$INCOME, 0.99)/quantile(psid$INCOME, 0.5), 2))) %>%
  as_tibble() %>%
  pander(caption = "PSID Household Income Percentile Ratios")
```


## Question 6: mean household income and share by quintile    
The following table further illustrates the income inequality among PSID households: the highest disparities between consecutive quintiles are between quintiles 1 and 2 and quintiles 4 and 5. Quintile 2 has a mean income of $33,188, 2.76 times the first quintile's mean income of $12,003. The second quintile's income share of 8.5% is 2.74 times that of the first quintile (3.1%). The fifth quintile's income of $199,894 is 2.21 times that of the fourth quintile ($90,408). The fifth quintile's income share of 51.1% is 2.21 times that of the fourth quintile. It's also notable that the income share of the top quintile is greater than that of the 4 lower quintiles combined. Taken together, this shows the high overall income inequality among PSID households, as well as the heightened inequality at the two ends of the distribution. 

Compared to SCF (Section 1.2, slide 9), the average income is lower for all quintiles in the PSID. The first four quintiles have a higher income share in the PSID, while the fifth quintile has a higher income share in the SCF. This pattern once again speaks to the difference in sampling across the two surveys. 

```{r income quintiles table, echo=FALSE}
psid_quintile <- psid %>%
  select(INCOME) %>%
  mutate(quintile = case_when(INCOME <= quantile(psid$INCOME, 0.2) ~ "1",
                              INCOME <= quantile(psid$INCOME, 0.4) ~ "2",
                              INCOME <= quantile(psid$INCOME, 0.6) ~ "3",
                              INCOME <= quantile(psid$INCOME, 0.8) ~ "4",
                              TRUE ~ "5")) %>%
  group_by(quintile) %>%
  summarize(income_quintile = sum(INCOME),
            mean_income = mean(INCOME)) %>%
  mutate(income_share = income_quintile/sum(income_quintile)) %>%
  select(quintile, income_share, mean_income)

psid_quintile %>%
  mutate(income_share = percent(income_share),
         mean_income=dollar(mean_income)) %>%
  pander(caption="Share of total household income and mean income by quintile")
```

```{r income quintile viz, echo=FALSE}  
psid_quintile %>%
  ggplot(aes(x = quintile, y = income_share)) +
  geom_col(fill = "darkslategray") +
  geom_text(aes(label = percent(income_share)),
            vjust = -0.3, size = 3.5) +
  scale_y_continuous(labels = percent) +
  labs(title="Top 20% of PSID households earns more income than bottom 80%", subtitle= "Share of total household income by quintile", x = "Income Quintile", y = "Share of Total Income") +
  theme_minimal()

```


## Question 7: mean total household income and share for the top 1%   
As discussed in class, looking at mean incomes and income shares by quintiles can obscure the inequality within the top of the distribution. Looking at the top 1% of households, we see that their mean income ($639,974) is 8.81 times that of the bottom 99% ($72,570), and 3.2 times that of the top quintile ($199,894). In terms of income share, the top 1% accounts for 8% of all household income, making up nearly one-sixth of the top quintile's share. Even within the top quintile, there is drastic inequality between the highest and lowest earners.   

Compared to the SCF (based on Section 1.2 Slide 9), the top 1% has a lower income share and mean income in the PSID (SCF reported 22.4% and $3.18 million in 2022).
```{r income top 1%, echo=FALSE}
psid_1pct <- psid %>%
  select(INCOME) %>%
  mutate(group = case_when(INCOME > quantile(psid$INCOME, 0.99) ~ "top 1%",
                              TRUE ~ "bottom 99%")) %>%
  group_by(group) %>%
  summarize(income_group = sum(INCOME),
            mean_income = mean(INCOME)) %>%
  mutate(income_share = income_group/sum(income_group)) %>%
  select(group, income_share, mean_income)

psid_1pct %>%
  mutate(income_share = percent(income_share),
         mean_income=dollar(mean_income)) %>%
  pander(caption="Share of total household income and mean income held by the top 1%")
```

# Part 3: Labor Income    
## Question 1: household earnings share and mean by quintile     
We can create a variable for the total labor income by adding the LABOR_HEAD and LABOR_SPOUSE. Looking at total labor earnings of households, the inequality within the bottom of the distribution is much higher. The table below lists the mean household earnings and share of household earnings by quintile. The second quintile of households ($14,976) earns 516 times the labor income of the first quintile ($29). The earnings inequality at the top of the distribution is also higher than household income inequality, but by a smaller margin.  

```{r total labor income quintile, echo=FALSE}
psid$TOTAL_LABOR <- psid$HEAD_LABOR + psid$SPOUSE_LABOR

test <- psid %>%
  mutate(earnings_quintile = ntile(TOTAL_LABOR, 5))

psid_labor_quintile <- psid %>%
  select(TOTAL_LABOR) %>%
  mutate(quintile = case_when(TOTAL_LABOR < quantile(psid$TOTAL_LABOR, 0.2) ~ "1",
                              TOTAL_LABOR < quantile(psid$TOTAL_LABOR, 0.4) ~ "2",
                              TOTAL_LABOR < quantile(psid$TOTAL_LABOR, 0.6) ~ "3",
                              TOTAL_LABOR < quantile(psid$TOTAL_LABOR, 0.8) ~ "4",
                              TRUE ~ "5")) %>%
  group_by(quintile) %>%
  summarize(labor_income_quintile = sum(TOTAL_LABOR),
            mean_labor_income = mean(TOTAL_LABOR)) %>%
  mutate(labor_income_share = labor_income_quintile/sum(labor_income_quintile)) %>%
  select(quintile, labor_income_share, mean_labor_income)

psid_labor_quintile %>%
  mutate(labor_income_share = percent(labor_income_share),
         mean_labor_income=dollar(mean_labor_income)) %>%
  pander(caption="Share of total household labor income and mean labor income by quintile")  

```  


## Question 2: total household income vs household earnings by quintile    
Side by side, we can see that the distribution of earnings share is more unequal. The bottom quintile's share of earnings rounds to zero, while the bottom quintile's share of total household income is 3.1%. Quintiles 2 and 3 also hold smaller shares of earnings than they do total income. Quintile 4 has a slightly higher share of earnings than total income, and quintile 5's share of earnings is higher than total income by 6.3 percentage points. Compared to the distribution of total income, earnings is more unevenly distributed, with higher percentage shares in the top 2 quintiles.     

```{r total income vs labor income quintile shares, echo=FALSE}
psid_quintile %>%
  inner_join(psid_labor_quintile, by="quintile") %>%
  mutate(total_income_share = percent(income_share),
         earnings_share = percent(labor_income_share)) %>%
           select(quintile, total_income_share, earnings_share) %>%
           pander(caption="Total income vs earnings quintile shares")

```

Calculating the coefficient of variation for both metrics confirms this: earnings have a coefficient of variation of 1.36, compared to 1.15 for household income. This indicates that there is more inequality in earnings than in income.    

```{r household income and earnings coefficient of variation, echo=FALSE}
data.frame(metric=c("Household Income", "Household Earnings"),
           cv=c(
             round(sd(psid$INCOME)/mean(psid$INCOME),2),
             round(sd(psid$TOTAL_LABOR)/mean(psid$TOTAL_LABOR),2))) %>%
  pander(caption="Coefficient of Variation: Household Income and Earnings")
```

This trend is seen when plotted on a Lorenz curve, as well. The curve representing cumulative households against cumulative earnings is more far away from the line of perfect equality, indicating that its distribution is more unequal than that of household income. As discussed in class, redistributive policies like social insurance and means-tested transfers may be contributing to the household income of households at the bottom of the income distribution who do not have labor income. Consequently, the bottom quintile can have a higher share of total household income than household earnings.   

```{r lorenz, total household income vs earnings, echo=FALSE}
psid_lorenz_earnings <- psid %>%
  arrange(TOTAL_LABOR) %>%
  mutate(INC_SHARE = TOTAL_LABOR / sum(TOTAL_LABOR),
    HHS_SHARE = 1 / nrow(.),
    CUM_HH_SHARE = 100*cumsum(HHS_SHARE),
    CUM_INC_SHARE = 100*cumsum(INC_SHARE))

ggplot() +
  geom_line(data = psid_lorenz, aes(x = CUM_HH_SHARE, y = CUM_INC_SHARE, color = "Household Income")) +
    geom_line(data = psid_lorenz_earnings, aes(x = CUM_HH_SHARE, y = CUM_INC_SHARE, color = "Household Earnings")) +
  geom_line(data = perfect_equality, aes(x = x, y = y, color = "perfect equality"), linetype = "dotted") +
  theme_minimal() +
  scale_color_manual(values = c("tomato", "goldenrod1", "gray30"), name = "") + 
  labs(
    title = "Household earnings is more unequal than household income",
    subtitle = "Lorenz curve of total household income and household earnings, PSID",
    x = "Cumulative share of households",
    y = "Cumulative share of income"
  ) +
  theme(legend.position = "bottom")
```


## Question 3: average share of total household income from earnings  
The average share of earnings in household income is 68.51%, indicating that households typically receive just over two-thirds of their income from labor income. This figure is excluding the 137 households with incomes of 0, as their share would be undefined. 
```{r share of labor in household income, echo=FALSE}
psid$EARNINGS_SHARE_OF_LABOR <- ifelse(psid$INCOME != 0, psid$TOTAL_LABOR/psid$INCOME, NA)

print(paste("Mean share of earnings in total household income:", round(100*mean(psid$EARNINGS_SHARE_OF_LABOR, na.rm=TRUE), 2)))
```


## Question 4: mean and share of labor earnings by quintile    
In the dataset, higher income households derive a larger share of their income from labor earnings. The most stark difference is between quintile 1 and 2: the mean share of labor is 46.6% in the former, and increases by 18.9 percentage points in quintile 2. The difference in the earnings share between the remaining quintiles is modest: between quintile 2 and 5, the total increase is less than that between quintile 1 and 2. 

Compared to the SCF (based on Section 1.2, Slide 11), 
```{r share of labor by quintile, echo=FALSE}
psid %>%
  mutate(quintile = case_when(INCOME <= quantile(psid$INCOME, 0.2) ~ "1",
                              INCOME <= quantile(psid$INCOME, 0.4) ~ "2",
                              INCOME <= quantile(psid$INCOME, 0.6) ~ "3",
                              INCOME <= quantile(psid$INCOME, 0.8) ~ "4",
                              TRUE ~ "5")) %>%
  group_by(quintile) %>%
  summarize(mean_labor_share = mean(EARNINGS_SHARE_OF_LABOR, na.rm=TRUE)) %>%
  select(quintile, mean_labor_share) %>%
  mutate(mean_labor_share=percent(mean_labor_share)) %>%
  pander(caption="Share of total household income from labor earnings by quintile, PSID")
``` 

When we separate the top 1% of households, we see that they get 77.1% of their income from labor earnings, higher than the overall mean. 

These shares are all higher than SCF (according to Section 1.2, Slide 11). The subset with the most dramatic different between PSID and SCF is the top 1%: in 2022, the SCF reported that 34.5% of household income in the top 1% came from labor, less than half of the PSID's estimate. The reason for this difference may be that SCF's wealthier sample relies more heavily on capital income, while PSID's sample captures a more representative breakdown of income sources. 
```{r share of labor earnings top 1%, echo=FALSE}
psid %>%
  mutate(group = case_when(INCOME > quantile(psid$INCOME, 0.99) ~ "top 1%",
                              TRUE ~ "bottom 99%")) %>%
  group_by(group) %>%
  summarize(mean_labor_share = mean(EARNINGS_SHARE_OF_LABOR, na.rm=TRUE)) %>%
  select(group, mean_labor_share) %>%
  mutate(mean_labor_share=percent(mean_labor_share)) %>%
  pander(caption="Share of total household income from labor earnings, top 1%, PSID")
```
  

## Question 5: weekly wage, contribution of hours and wages to labor earnings inequality  
In the dataset, there are 6,971 households where the household head has positive labor earnings and weeks of work. The mean weekly wage for these household heads is $1,117.74.  

```{r positive labor, echo=FALSE}
psid_positive <- psid %>%
  filter(HEAD_LABOR > 0 & WEEKS_HEAD > 0)

nrow(psid_positive)

psid_positive$weekly_wage <- psid_positive$HEAD_LABOR/psid_positive$WEEKS_HEAD
mean(psid_positive$weekly_wage)
```

A variance decomposition shows that most earnings inequality arises from wage dispersion: the variance of log wages (0.87) is much larger than the variance of log weeks worked (0.17). The positive covariance (0.15) indicates that individuals with higher wages also tend to work more weeks, further amplifying overall earnings inequality. These results suggest that differences in wages contribute much more to earnings inequality than differences in weeks worked.

However, a caveat to this decomposition is that it assumes a covariance of zero when this is not the case. We cannot fully separate out the link between earnings and pay vs weekly wages. Additionally, this analysis is restricted to household heads with positive weeks worked and positive labor earnings. By excluding those who did not work or earn, the approach may understate the role of weeks worked in earnings inequality, as those at the bottom of the earnings distribution could be working very few weeks or not at all due to limited employment opportunities. 

```{r var of log of earnings, echo=FALSE}
psid_positive_log <- psid_positive %>%
  mutate(
    log_earnings = log(HEAD_LABOR),
    log_wage = log(weekly_wage),
    log_weeks = log(WEEKS_HEAD)
  )

var_log_earnings <- var(psid_positive_log$log_earnings, na.rm = TRUE)
var_log_wage <- var(psid_positive_log$log_wage, na.rm = TRUE)
var_log_weeks <- var(psid_positive_log$log_weeks, na.rm = TRUE)

tibble(
component = c("Var(log wage)", "Var(log weeks)", "2*Cov(log wage, log weeks)", "Var(log earnings)"),
  value = c(var_log_wage, var_log_weeks, 2 * cov_log, var_log_earnings)
) %>%
  pander("Weekly wages log decomposition results") 
```



## Question 6 
A linear regression of the log-transformed weekly wage of the household head on the head's age, age-squared, education, and occupation provides further information about the drivers of wage inequality. The observables in this regression explain 44% of the variation in log-transformed weekly wages, while the residuals (residual standard error = 0.7243) explain 56%. 
```{r wages regression, echo=FALSE}
psid_reg <- psid_positive_log %>%
  mutate(EDU_HEAD_CAT = as.factor(EDU_HEAD),
         OCC_HEAD_CAT = as.factor(OCC_HEAD),
         AGE_HEAD_SQ = AGE_HEAD^2)

reg <- lm(log_wage ~ AGE_HEAD + AGE_HEAD_SQ + EDU_HEAD_CAT + OCC_HEAD_CAT, data = psid_reg)
```

```{r compare residuals vs predictors, echo=FALSE}
print(paste("Share of inequality explained by observables:", round(var(reg$fitted.values)/var(psid_reg$log_wage),2)))
print(paste("Share of inequality explained by residuals:", round(var(reg$residuals)/var(psid_reg$log_wage),2)))
```


 