---
title: "ECON4225 Homework 2"
output: 
  pdf_document:
    number_sections: no
    keep_md: yes
date: "11-18-2025"
author: "Anna Duan"
---
```{r setup, echo=FALSE, message=FALSE, include=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(pander)
library(scales)

psid <- read_csv("data/PSID_CLEAN.csv")
```


# Part 1: Wealth Distribution  
## Question 1: Wealth histogram   
The distribution of household wealth in the PSID is right-skewed, with a higher mean than median. This means that a small number of extremely high-wealth households at the top of the distribution are pushing up the mean household wealth figure. Most households have less than $180,000 in wealth, which is the 75th percentile. Some households (1497) have negative wealth, indicating higher liabilities than assets. The following histogram visualizes this distribution, omitting outliers outside of the 1st to 99th percentile.    
  
  
  
```{r hh wealth hist, echo=FALSE, fig.height=4, fig.width=6}
psid_filtered <- psid %>% 
  filter(
    WEALTH >= quantile(WEALTH, 0.01, na.rm = TRUE),
    WEALTH <= quantile(WEALTH, 0.99, na.rm = TRUE)
  )

ggplot(psid_filtered, aes(x = WEALTH/1000)) + 
  geom_histogram(binwidth = 10, fill = "darkcyan", color=NA) +
  labs(
    title = "Distribution of Household Wealth, PSID",
    subtitle = "Outliers outside of 1st-99th percentile omitted",
    x = "Household Wealth (Thousands of $)",
    y = "Number of Households"
  ) +
  scale_x_continuous(labels = scales::dollar_format(prefix = "$", suffix = "k")) +
  theme_minimal()

```

## Question 2: Lorenz curve, wealth    
In the PSID, the bottom 50% of households hold -2.3% of total wealth; the bottom 75% hold 6.3%; the top 10% hold 74.5%; and the top 1% hold 29.2%. The diagonal gray line indicates perfect equality, where 50% of households would collectively hold 50% of wealth. Compared to this line, we see that lower wealth households do not hold a proportional amount of wealth, indicating severe wealth inequality.  
  
   
```{r Lorenz curve: wealth, echo=FALSE, fig.height=4, fig.width=6}
psid_lorenz_wealth <- psid %>%
  filter(!is.na(WEALTH)) %>%                 
  arrange(WEALTH) %>%
  mutate(
    rank_WEALTH = cume_dist(WEALTH),        
    cumshare_WEALTH = cumsum(WEALTH) / sum(WEALTH)
  )

ggplot(psid_lorenz_wealth) +
  geom_line(aes(x = rank_WEALTH, y = cumshare_WEALTH),
            color = "darkcyan") +
  geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "gray") +
  xlab("Cumulative share of households (rank)") +
  ylab("Cumulative share of household wealth") +
  labs(title = "Lorenz curve of Household Wealth, PSID") + 
  theme_minimal()
```

## Question 3: Coefficient of variation   
The coefficient of variation for wealth in the PSID is 4.65. It is 7.52 in the SCF for 2019 and 7.63 for 2022. By this measure, inequality is lower in the PSID than in the SCF. This is likely because SCF over-samples the wealthiest households, and because the coefficient of variation is most sensitive to changes in the upper tail of the distribution.     
  
  
```{r coefficient of variation, echo=FALSE}
# round(sd(psid$WEALTH)/mean(psid$WEALTH),3)
```

## Question 4: Percentiles and percentile ratios  
The 30th percentile of wealth is $2,500, meaning 30% of households have a net worth of $2,500 or less. The 50th percentile of wealth is $31,000, meaning 50% of households have a net worth of $31,000 or less. The 90th percentile of wealth is $596,312, meaning 90% of households have a net worth of $596,312 or less. The 99th percentile of wealth is $3,395,780, which means 99% of households have a net worth of $3,395,780 or less.  
  
  

```{r wealth percentiles, echo=FALSE}
wealth_percentiles <- psid %>%
  filter(!is.na(WEALTH)) %>%
  summarize(
    `10th` = (quantile(WEALTH, 0.10, na.rm = TRUE)),
    `30th` = (quantile(WEALTH, 0.30, na.rm = TRUE)),
    `50th` = (quantile(WEALTH, 0.50, na.rm = TRUE)),
    `90th` = (quantile(WEALTH, 0.90, na.rm = TRUE)),
    `99th` = (quantile(WEALTH, 0.99, na.rm = TRUE))
  )

wealth_percentiles %>%
  select(-'10th') %>%
  mutate(across(ends_with("th"), scales::dollar)) %>%
  pander("Wealth percentiles, PSID")
```

The 90:30 percentile ratio is 238.5, meaning households at the 90th percentile have 238.5 times the net worth of those at the 30th percentile. The 90:50 ratio is 19.2, meaning households at the 90th percentile have 19.2 times the net worth of those at the 50th percentile. The 30:10 ratio is -0.193; this strange number arises from the fact that households at the 30th percentile have positive wealth($2500), while households at the 10th percentile have negative wealth(-$12,977). The 99-50 ratio is 109.5. This means households at the 99th percentile have 109.5 times the net worth of those at the 50th percentile. In all, these figures show there is not just vast inequality in wealth overall, but also high levels within the top 10%.   
  
  

```{r percentile ratios, echo=FALSE}
wealth_percentiles %>%
  mutate(
    ratio_90_30 = `90th` / `30th`,
    ratio_90_50 = `90th` / `50th`,
    ratio_30_10 = `30th` / `10th`,
    ratio_99_50 = `99th` / `50th`
  ) %>%
  select(starts_with("ratio")) %>%
  pander("Wealth percentile ratios")
```

The 99:50 ratio in the SCF was 91.31 in 2019 and 70.66 in 2022. As both of these are lower than the PSID's 109.5 figure, this indicates more inequality between the absolute top of the distribution and the middle class in the PSID. The SCF's 90:50 ratio was 9.98 in 2019 and 10.05 in 2022. The 90:50 ratio in the PSID (19.2) is greater, suggesting greater inequality between the top and the middle as well in the PSID. These differences may be attributed to differences and uncertainties in sampling. across the two surveys.  

## Question 5: Share of wealth and average wealth by wealth quintile    
The first wealth quintile holds –3.4% of total wealth, while the second quintile accounts for 0.3%. The third quintile’s share is 2.6%, and the fourth has 10.9%. The top quintile holds 89.6%. As in the SCF, the lowest quintile’s share is negative, and the distribution climbs sharply moving up the distribution, highlighting high inequality.

Average wealth also increases dramatically across groups. Households in the first quintile have mean wealth of –$52,537, those in the second average $3,021, and those in the third hold $33,883. The fourth quintile averages $140,330, and the top quintile reaches $1,150,896. These figures again reveal a steep escalation in typical wealth moving up the quintiles.  
  
  

```{r share of wealth by quintile, echo=FALSE}
psid_quintiles_wealth <- psid %>%
  filter(!is.na(WEALTH)) %>% 
  mutate(rank_WEALTH = cume_dist(WEALTH)) %>%
  mutate(quintile = 0) %>%
  mutate(
    quintile = replace(quintile, rank_WEALTH <= 0.2, 1),
    quintile = replace(quintile, rank_WEALTH > 0.2 & rank_WEALTH <= 0.4, 2),
    quintile = replace(quintile, rank_WEALTH > 0.4 & rank_WEALTH <= 0.6, 3),
    quintile = replace(quintile, rank_WEALTH > 0.6 & rank_WEALTH <= 0.8, 4),
    quintile = replace(quintile, rank_WEALTH > 0.8, 5)
  ) %>%
  group_by(quintile) %>%
  summarize(
    mean_wealth  = mean(WEALTH),
    total_wealth = sum(WEALTH)
  ) %>%
  ungroup() %>%
  mutate(
    wealth_share = total_wealth / sum(total_wealth)
  )

psid_quintiles_wealth %>%
  mutate(
    mean_wealth = dollar(mean_wealth),
    wealth_share = percent(wealth_share, accuracy = 0.1)
  ) %>% 
  select(-total_wealth) %>%
  pander(caption ="Mean wealth and wealth share by wealth quintile")

```


Looking at the 2022 SCF, the bottom quintile reported a –0.2% share of total wealth and an average of –$11.8k. The second quintile held 1% of wealth with an average of $54.1k, and the third held 3.8% with a mean wealth of $199.6k The fourth quintile accounted for 10.1% of total wealth and averaged $533.4k, while the top quintile held 85.4% and had an average of $4.5 million. Relative to the SCF, the PSID reports smaller wealth shares for the bottom three quintiles and somewhat larger ones to the top two. The SCF shows higher average wealth values for the second through fifth quintiles. While the PSID's numbers indicate higher wealth inequality, the SCF's higher mean values may stem from their oversampling of wealthier households.


## Question 6: Share of wealth and average wealth for the top 1%   
The richest 1% holds 29.3% of total wealth, with an average net worth of $7,511,289.

According to the 2022 SCF, the top 1% held 35.1% of total wealth and had an average wealth level of $37.1 million. Compared with the PSID, the SCF reports both a larger wealth share and a higher average wealth for this group. This outcome is expected, as the SCF intentionally oversamples high-wealth households.  
  
  
```{r share and average welath at top 1%, echo=FALSE}
p99_cutoff <- psid %>%
  filter(!is.na(WEALTH)) %>%
  summarize(cutoff = quantile(WEALTH, 0.99)) %>%
  pull(cutoff)

psid_top1pct <- psid %>%
  mutate(top1 = WEALTH > p99_cutoff)

top1_stats <- psid_top1pct %>%
  filter(top1, !is.na(WEALTH)) %>%
  summarize(mean_wealth_top1 = mean(WEALTH))

total_wealth <- psid_top1pct %>%
  filter(!is.na(WEALTH)) %>%
  summarize(total = sum(WEALTH)) %>%
  pull(total)

top1_wealth <- psid_top1pct %>%
  filter(top1, !is.na(WEALTH)) %>%
  summarize(total = sum(WEALTH)) %>%
  pull(total)

share_top1 <- top1_wealth / total_wealth

tibble(
  `Wealth group` = "Top 1%",
  `Average wealth` = dollar(top1_stats$mean_wealth_top1),
  `Share of total wealth` = percent(share_top1, accuracy = 0.1)
) %>%
  pander("Mean wealth and wealth share of the top 1%")

```
  
  
  
  
## Question 7: Home equity and business value shares by quintile   
The average portfolio shares of home equity and business across the wealth quintiles are displayed in the following table. Home equity share is negative for the first quintile, indicating debt, and peaks in the third and fourth quintiles before declining again in the top quintile. Business share is also negative in the first quintile, but increases with wealth, with the exception of a dip in quintile 4.   

These patterns indicate that medium-wealth households rely more heavily on housing as a component of their net worth, with home equity forming the majority of wealth for the fourth quintile and remaining most important for the middle of the distribution. In contrast, the wealthiest households allocate a larger share of their portfolios to business assets, with a dramatic increase between quintiles 4 and 5.  
  
  
```{r home equity and business as share of wealth by quintiles, echo=FALSE}
psid_home_eq_business <- psid %>%
  filter(!is.na(WEALTH)) %>%
  mutate(quintile = ntile(WEALTH, 5)) %>%   # simpler quintile code
  group_by(quintile) %>%
  summarize(
    home_equity_share = sum(HOME_EQUITY, na.rm = TRUE) / sum(WEALTH, na.rm = TRUE),
    business_share    = sum(BUSINESS_VAL, na.rm = TRUE) / sum(WEALTH, na.rm = TRUE)
  ) %>%
  ungroup() %>%
  mutate(
    home_equity_share = scales::percent(home_equity_share, accuracy = 0.1),
    business_share    = scales::percent(business_share, accuracy = 0.1)
  )

psid_home_eq_business %>%
  pander("Home equity and business share of wealth by wealth quintiles")

```
  


## Question 8: Household wealth and portfolio composition by age  
The average wealth for households increases with each successively older age group, with the sharpest jumps between the below 25 group and 25-34; 25-34 and 35-44; and 45-54 and 55-64. This is to be expected, as households accumulate wealth over their life cycles, and can generate higher amounts of it when they are earning their highest incomes in their middle age. 25-34 also marks the entry into the workforce for people with advanced degrees, hence the more than doubling of wealth. Households also save more when expecting a decline in income, so those nearing retirement are likely more inclined to save a larger share in preparation.  

The corresponding portfolio shares show that house values' share declines with age. This is because households diversify as they age, therefore younger households' portfolios consist of a larger share of home value compared to other assets.

Mortgage debt peaks in the 25-34 age group (66.1%), then steadily declines with age. This may be because households often form families and buy homes in the 25-34 range, therefore that group is more likely to have a mortgage than the below 25 group. As the household ages, it will pay off more and more of its mortgage while accruing more wealth, leading to the mortgage making up a smaller share of their wealth over time. 

Home equity generally decreases with age, with the exception of a slight uptick in 45-54. This decline can be linked with the decline in the share of home value.   

Finally, business share increases until the 35-44 age group (35%), then starts to decline, before picking up slightly in the final 65+ group. This may be because middle aged households have had time to build up their portfolios and invest in their own businesses, and are in their prime working and earning years. After this age range though, households may invest more of their money in safer assets as they near retirement.    

Overall, households gain wealth and diversify their portfolios with age.  
  

```{r wealth and portfolio composition by age, echo=FALSE}
psid_age_wealth <- psid %>%
  filter(!is.na(AGE_HEAD) & !is.na(WEALTH) & WEALTH != 0) %>%
  mutate(
    age = factor(
      case_when(
        AGE_HEAD < 25 ~ "Below 25",
        AGE_HEAD >= 25 & AGE_HEAD <= 34 ~ "25-34",
        AGE_HEAD >= 35 & AGE_HEAD <= 44 ~ "35-44",
        AGE_HEAD >= 45 & AGE_HEAD <= 54 ~ "45-54",
        AGE_HEAD >= 55 & AGE_HEAD <= 64 ~ "55-64",
        AGE_HEAD >= 65 ~ "65+"
      ),
      levels = c("Below 25", "25-34", "35-44", "45-54", "55-64", "65+"),
      ordered = TRUE
    )
  ) %>%
  filter(!is.na(age)) %>%
  group_by(age) %>%
  summarize(
    avg_wealth          = mean(WEALTH, na.rm = TRUE),
    share_housevalue    = sum(HOUSE_VALUE, na.rm = TRUE) / sum(WEALTH, na.rm = TRUE),
    share_mortgage      = sum(MORTGAGE, na.rm = TRUE) / sum(WEALTH, na.rm = TRUE),
    share_homeeq        = sum(HOME_EQUITY, na.rm = TRUE) / sum(WEALTH, na.rm = TRUE),
    share_business      = sum(BUSINESS_VAL, na.rm = TRUE) / sum(WEALTH, na.rm = TRUE)
  ) %>%
  ungroup() %>%
  mutate(
    wealth         = scales::dollar(avg_wealth),
    house_share    = scales::percent(share_housevalue, accuracy = 0.1),
    mortgage_share = scales::percent(share_mortgage, accuracy = 0.1),
    home_eq_share  = scales::percent(share_homeeq, accuracy = 0.1),
    business_share = scales::percent(share_business, accuracy = 0.1)
  ) %>%
  select(age, wealth, ends_with("share"))


psid_age_wealth %>%
  pander("Average wealth and portfolio composition by age group")
```

  

# Part 2: Expenditure    

## Question 1: Spending histogram      
The distribution of spending in the PSID is right-skewed due to a small number of very high-spending households. All values are non-negative, and spending is more heavily concentrated below $100,000. The dispersion in expenditures is noticeably smaller than that observed in the wealth and income distributions.   
   
  
```{r spending histogram, echo=FALSE, fig.height=4, fig.width=6}
ggplot(psid, aes(x = EXP/1000)) +
  geom_histogram(
    binwidth = 1,
    fill = "darkcyan",
    color = NA
  ) +
  labs(
    title = "Distribution of Household Spending (PSID)",
    subtitle = "binwidth = $1000",
    x = "Household total spending ($)",
    y = "Number of households"
  ) +
  scale_x_continuous(labels = label_dollar(suffix = "k")) +
  theme_minimal()

```  
  
## Question 2: Lorenz curve, spending   
Following is the Lorenz curve for household spending. The curve lies noticeably below the 45-degree line of perfect equality, showing that expenditures are unevenly distributed across households. The bottom 50% of households account for 26% of total spending, while the bottom 75% account for 52%. At the upper end, the top 10% of households are responsible for 25% of all spending, and the top 1% account for 4%. Although spending is clearly unequal, the Lorenz curve indicates that expenditure is less unevenly distributed than either wealth or income.    
   
  
```{r lorenz curve of spending, echo=FALSE, fig.height=4, fig.width=6}
psid_lorenz_spending <- psid %>%
  filter(!is.na(EXP)) %>% 
  arrange(EXP) %>%
  mutate(
    rank_EXP = cume_dist(EXP),             
    cumshare_EXP = cumsum(EXP) / sum(EXP)     
  )

ggplot(psid_lorenz_spending, aes(x = rank_EXP, y = cumshare_EXP)) +
  geom_line(color = "darkcyan") +
  geom_abline(slope = 1, intercept = 0, linetype = "dashed") +
  labs(
    title = "Lorenz Curve of Household Spending (PSID)",
    x = "Cumulative share of households",
    y = "Cumulative share of total spending"
  ) +
  scale_x_continuous(labels = percent) +
  scale_y_continuous(labels = percent) +
  theme_minimal(base_size = 12)
```  
  
## Question 3: Share of spending and average spending by spending quintile    
Across the expenditure distribution, both spending shares and average expenditures rise across quintiles, though the increases are not as sharp as those observed for income or wealth.  

While inequality in spending does exist, with the sharpest gaps between quintiles 1 and 2 and quintiles 4 and 5, it is noticeably less pronounced than income or wealth.   
  
  
```{r expenditure share and mean by quintile, echo=FALSE}
psid %>%
  filter(!is.na(EXP)) %>%
  mutate(rank_EXP = cume_dist(EXP)) %>%
  mutate(quintile_EXP = 0) %>%
  mutate(
    quintile_EXP = replace(quintile_EXP, rank_EXP <= 0.2, 1),
    quintile_EXP = replace(quintile_EXP, rank_EXP > 0.2 & rank_EXP <= 0.4, 2),
    quintile_EXP = replace(quintile_EXP, rank_EXP > 0.4 & rank_EXP <= 0.6, 3),
    quintile_EXP = replace(quintile_EXP, rank_EXP > 0.6 & rank_EXP <= 0.8, 4),
    quintile_EXP = replace(quintile_EXP, rank_EXP > 0.8, 5)
  ) %>%
  group_by(quintile_EXP) %>%
  summarize(
    avg_spending  = mean(EXP, na.rm = TRUE),
    total_spending = sum(EXP, na.rm = TRUE)
  ) %>%
  ungroup() %>%
  mutate(
    quintile = quintile_EXP, 
    share_total_spending = total_spending / sum(total_spending),
    spending_avg  = dollar(avg_spending),
    spending_share = percent(share_total_spending, accuracy = 0.1)
  ) %>%
  select(quintile, starts_with("spending")) %>%
  pander("Average spending and spending share by spending quintile")

```  
  
## Question 4: Expenditure category shares by income quintiles    
  
Looking at spending shares by category across income quintiles, we see that high and low income households have distinct spending patterns. The share of spending used on food at home and rent get lower the higher a household's income is. This is because these are necessities, and while everybody needs them, they will cost proportionally more for lower income households.  

Food bought outside of the home has a similar pattern, where the bottom 3 quintiles spend a larger share of their total spending on it than the top 2 quintiles. Trips have the opposite pattern: the higher a household's income, the higher the share of their spending going towards trips. This may be because travel is a luxury good, for which demand goes up with income. Gas is somewhere in the middle: quintiles 2-4 have the highest share of spending towards gas. Perhaps the first quintile tends not to have cars, and the top quintile's spending is higher, leading to the same gas spending as quintiles 2-4 being a smaller share of their total spending.
  
  
```{r share of expenditure in each category, echo=FALSE}
psid_expenditure_categories <- psid %>%
  filter(!is.na(INCOME), !is.na(EXP)) %>%
  mutate(rank_INCOME = cume_dist(INCOME)) %>%
  mutate(inc_quintile = 0) %>%
  mutate(
    inc_quintile = replace(inc_quintile, rank_INCOME <= 0.2, 1),
    inc_quintile = replace(inc_quintile, rank_INCOME > 0.2 & rank_INCOME <= 0.4, 2),
    inc_quintile = replace(inc_quintile, rank_INCOME > 0.4 & rank_INCOME <= 0.6, 3),
    inc_quintile = replace(inc_quintile, rank_INCOME > 0.6 & rank_INCOME <= 0.8, 4),
    inc_quintile = replace(inc_quintile, rank_INCOME > 0.8, 5)
  ) %>%
  mutate(
    share_food_home = if_else(EXP != 0, FOOD_HOME / EXP, NA_real_),
    share_food_out  = if_else(EXP != 0, FOOD_OUT / EXP, NA_real_),
    share_gas       = if_else(EXP != 0, GAS / EXP, NA_real_),
    share_rent      = if_else(EXP != 0, RENT / EXP, NA_real_),
    share_trips     = if_else(EXP != 0, TRIPS / EXP, NA_real_)
  ) %>%
  group_by(inc_quintile) %>%
  summarize(
    food_home = mean(share_food_home, na.rm = TRUE),
    food_out  = mean(share_food_out, na.rm = TRUE),
    gas       = mean(share_gas, na.rm = TRUE),
    rent      = mean(share_rent, na.rm = TRUE),
    trips     = mean(share_trips, na.rm = TRUE)
  ) %>%
  ungroup() %>%
  mutate(across(c("food_home", "food_out", "gas", "rent", "trips"), ~percent(.x, accuracy = 0.1))) %>%
  rename(quintile = inc_quintile)

psid_expenditure_categories %>%
  pander("Spending category shares by income quintile")
```  
  
## Question 5: Highest exposure to changes in fuel prices    

Based on the previous section, middle income (quintiles 2-4) households are most exposed to changes in fuel prices. These households may be more likely to own cars than the poorest households, and more financially burdened by the associated costs than the wealthiest households. It is also possible, however, that fuel price changes will impact the cost of trips, therefore affecting wealthy households who spend the most on travel.  

## Question 6: Share of income spent by income quintile    
Savings rates rise consistently with income, while spending declines with income. Higher-income households devote a smaller share of their income to consumption, while lower-income households spend a much larger portion, sometimes more than they earn. For example, the top quintile saves 57.4% of its income, whereas the bottom quintile has a negative savings rate, indicating that it spends beyond its income. As income increases, a greater fraction is saved rather than consumed. These differences in savings behavior contribute to widening wealth inequality, since higher savings rates enable greater future wealth accumulation.  
  
  

```{r share of income spent by income quintile, echo=FALSE}
psid_savings_quintile <- psid %>%
  filter(!is.na(INCOME), !is.na(EXP)) %>%
  mutate(rank_INCOME = cume_dist(INCOME)) %>%
  mutate(inc_quintile = 0) %>%
  mutate(
    inc_quintile = replace(inc_quintile, rank_INCOME <= 0.2, 1),
    inc_quintile = replace(inc_quintile, rank_INCOME > 0.2 & rank_INCOME <= 0.4, 2),
    inc_quintile = replace(inc_quintile, rank_INCOME > 0.4 & rank_INCOME <= 0.6, 3),
    inc_quintile = replace(inc_quintile, rank_INCOME > 0.6 & rank_INCOME <= 0.8, 4),
    inc_quintile = replace(inc_quintile, rank_INCOME > 0.8, 5)
  ) %>%
  mutate(share_spent = if_else(INCOME != 0, EXP / INCOME, NA_real_)) %>%
  group_by(inc_quintile) %>%
  summarize(
    tot_income   = sum(INCOME, na.rm = TRUE),
    tot_spending = sum(EXP, na.rm = TRUE),
    share_spent_agg_num = tot_spending / tot_income,       
    .groups = "drop"
  ) %>%
  mutate(
    implied_savings_rate_agg_num = 1 - share_spent_agg_num
  ) %>%
  mutate(
    share_spent = percent(share_spent_agg_num, accuracy = 0.1),
    share_saved = percent(implied_savings_rate_agg_num, accuracy = 0.1)
  ) %>%
  select(inc_quintile, share_spent, share_saved)

psid_savings_quintile %>%
  pander("Share of income spent vs saved by income quintile")
```



# Part 3: Comparing Distributions   

## Question 1: Lorenz Curve of income, wealth, spending   
Plotting the Lorenz curves of household income, wealth, and spending in the PSID, we see that the curve for wealth is furthest away from the line of perfect equality, while the curve for spending is closest. This indicates that the distribution of wealth is more unequal than income and spending, and that spending is the most equal.
  
  

```{r income, wealth, spending lorenz, echo=FALSE, fig.height=4, fig.width=6}
perfect_equality <- data.frame(x = c(0, 25, 75, 100), y = c(0, 25, 75, 100))

lorenz_income <- psid %>%
  arrange(INCOME) %>%
  mutate(INC_SHARE = INCOME / sum(INCOME),
    HHS_SHARE = 1 / nrow(.),
    CUM_HH_SHARE = 100*cumsum(HHS_SHARE),
    CUM_INC_SHARE = 100*cumsum(INC_SHARE))

lorenz_wealth <- psid %>%
  arrange(WEALTH) %>%
  mutate(W_SHARE = WEALTH / sum(WEALTH),
    HHS_SHARE = 1 / nrow(.),
    CUM_HH_SHARE = 100*cumsum(HHS_SHARE),
    CUM_W_SHARE = 100*cumsum(W_SHARE))

lorenz_spending <- psid %>%
  arrange(EXP) %>%
  mutate(EXP_SHARE = EXP / sum(EXP),
    HHS_SHARE = 1 / nrow(.),
    CUM_HH_SHARE = 100*cumsum(HHS_SHARE),
    CUM_EXP_SHARE = 100*cumsum(EXP_SHARE))

ggplot() +
  geom_line(data = lorenz_income, aes(x = CUM_HH_SHARE, y = CUM_INC_SHARE, color = "Income")) +
  geom_line(data = lorenz_wealth, aes(x = CUM_HH_SHARE, y = CUM_W_SHARE, color = "Wealth")) +
  geom_line(data = lorenz_spending, aes(x = CUM_HH_SHARE, y = CUM_EXP_SHARE, color = "Spending")) +
  geom_line(data = perfect_equality, aes(x = x, y = y, color = "perfect equality"), linetype = "dotted") +
  theme_minimal() +
  scale_color_manual(values = c("salmon", "gray", "goldenrod1", "darkcyan"), name = "") + 
  labs(
    title = "Lorenz Curve of Household Income, Wealth, and Spending",
    x = "Cumulative share of households",
    y = "Cumulative share of variable"
  ) +
  theme(legend.position = "bottom")
  
```
  
  
## Question 2: Share of total income, wealth, spending by respective quintiles    
The quintile shares and coefficients of variation for income, wealth, and spending confirm that wealth is the most unequal, and spending is the most evenly distributed.  

The top quintile of households by wealth hold 89.5% of all wealth, compared to the 51.1% and 40.8% of income and spending held by the top quintiles for those metrics. Similarly, the bottom quintile of households by wealth hold a negative share of total wealth, as they are in debt, while the equivalent quintile in income and spending hold low but positive shares of their respective variables. Across all three metrics, the biggest gap is between quintiles 4 and 5, speaking to high inequality at the top of each distribution. However, this gap is widest for wealth, which increases more than seven-fold between quintiles 4 and 5.   
  
    
```{r quintiles of income, wealth, spending, echo=FALSE}
quintile_income <- psid %>%
  select(INCOME) %>%
  mutate(quintile = case_when(INCOME <= quantile(psid$INCOME, 0.2) ~ "1",
                              INCOME <= quantile(psid$INCOME, 0.4) ~ "2",
                              INCOME <= quantile(psid$INCOME, 0.6) ~ "3",
                              INCOME <= quantile(psid$INCOME, 0.8) ~ "4",
                              TRUE ~ "5")) %>%
  group_by(quintile) %>%
  summarize(income_quintile = sum(INCOME)) %>%
  mutate(income_share = income_quintile/sum(income_quintile)) %>%
  select(quintile, income_share)

quintile_wealth <- psid %>%
  select(WEALTH) %>%
  mutate(quintile = case_when(WEALTH <= quantile(psid$WEALTH, 0.2) ~ "1",
                              WEALTH <= quantile(psid$WEALTH, 0.4) ~ "2",
                              WEALTH <= quantile(psid$WEALTH, 0.6) ~ "3",
                              WEALTH <= quantile(psid$WEALTH, 0.8) ~ "4",
                              TRUE ~ "5")) %>%
  group_by(quintile) %>%
  summarize(wealth_quintile = sum(WEALTH)) %>%
  mutate(wealth_share = wealth_quintile/sum(wealth_quintile)) %>%
  select(quintile, wealth_share)

quintile_spending <- psid %>%
  select(EXP) %>%
  mutate(quintile = case_when(EXP <= quantile(psid$EXP, 0.2) ~ "1",
                              EXP <= quantile(psid$EXP, 0.4) ~ "2",
                              EXP <= quantile(psid$EXP, 0.6) ~ "3",
                              EXP <= quantile(psid$EXP, 0.8) ~ "4",
                              TRUE ~ "5")) %>%
  group_by(quintile) %>%
  summarize(spending_quintile = sum(EXP)) %>%
  mutate(spending_share = spending_quintile/sum(spending_quintile)) %>%
  select(quintile, spending_share)

quintiles <- quintile_income %>%
  inner_join(quintile_wealth, by = "quintile") %>%
  inner_join(quintile_spending, by = "quintile") 

quintiles %>%
  mutate(income_share = percent(income_share),
         wealth_share = percent(wealth_share),
         spending_share = percent(spending_share)) %>%
  pander(caption="Share of total household income, wealth, and spending by respective quintiles")
```
  
The coefficients of variation for the three variables show the same pattern: household wealth has a coefficient of 4.65, followed by income at 1.15, and spending at 0.7. This tells us again that household wealth is the most unequally distributed and spending is the least. 
   
  
```{r coefficient of variation multi, echo=FALSE}
data.frame(metric=c("Income", "Wealth", "Spending"),
           cv=c(
             round(sd(psid$INCOME)/mean(psid$INCOME),2),
             round(sd(psid$WEALTH)/mean(psid$WEALTH),2),
             round(sd(psid$EXP)/mean(psid$EXP),2))) %>%
  pander(caption="Coefficient of Variation: Household Income, Wealth, Spending")
```

## Question 3: Income distribution quintiles: income, spending, and wealth     

When aggregating households by income quintile, we see that income is likely more correlated with wealth than with spending. The bottom quintile of households based on income holds 3.1% and 3.6% respectively for income and wealth, yet they make up 9.1% of spending. Similarly, the top quintile holds 51.1% of income and 59.4% of wealth, but only 36.2% of spending. In addition to showing that income and wealth are likely more correlated than either are to spending, we also see once again that income and wealth are more unequal than spending. All 3 variables are positively correlated though: spending and wealth both increase with income.   
  
  
  
```{r income quintiles: income, wealth, spending, echo=FALSE}
quintile_income <- psid %>%
  select(INCOME, WEALTH, EXP) %>%
  mutate(quintile = case_when(INCOME <= quantile(psid$INCOME, 0.2) ~ "1",
                              INCOME <= quantile(psid$INCOME, 0.4) ~ "2",
                              INCOME <= quantile(psid$INCOME, 0.6) ~ "3",
                              INCOME <= quantile(psid$INCOME, 0.8) ~ "4",
                              TRUE ~ "5")) %>%
  group_by(quintile) %>%
  summarize(income_quintile = sum(INCOME),
            wealth_quintile = sum(WEALTH),
            spending_quintile = sum(EXP)) %>%
  mutate(income_share = income_quintile/sum(income_quintile),
         wealth_share = wealth_quintile/sum(wealth_quintile),
         spending_share = spending_quintile/sum(spending_quintile)) %>%
  select(quintile, income_share, wealth_share, spending_share)

quintile_income %>%
  mutate(income_share = percent(income_share),
         wealth_share = percent(wealth_share),
         spending_share = percent(spending_share)) %>%
  pander(caption="Share of total income, wealth, and spending by income quintiles")
```
  
## Question 4: Wealth distribution quintiles     

Looking at the wealth quintiles, we see that higher wealth households tend to have more income from non-labor sources, with the exception of quintile 2, which has a higher share than quintile 3 and 4. This aligns with our discussions in class: at the top of the wealth distribution, households are likely to have business and capital income make up a larger share. They also tend to be older, so part of the non-labor income could be from transfers. 
   
  
```{r wealth quintiles: non-labor earnings as share of total income, echo=FALSE}
quintile_wealth <- psid %>%
  filter(!is.na(WEALTH) & !is.na(INCOME)) %>%
  select(INCOME, WEALTH, HEAD_LABOR, SPOUSE_LABOR) %>%
  mutate(quintile = ntile(WEALTH, 5),
         non_labor_earnings = (INCOME - (HEAD_LABOR+SPOUSE_LABOR))) %>%
  group_by(quintile) %>%
  summarize(non_labor_income_share = sum(non_labor_earnings, na.rm=TRUE)/sum(INCOME, na.rm = TRUE)) %>%
  select(quintile, non_labor_income_share)

quintile_wealth %>%
  mutate(non_labor_income_share = percent(non_labor_income_share)) %>%
  pander(caption="Average share of income not from labor, by wealth quintiles")
```
